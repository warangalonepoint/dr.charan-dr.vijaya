<!doctype html><html lang="en" data-theme="dark"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Pharmacy Inventory — Dr. Charan Child Clinic</title>
<link rel="manifest" href="./public/manifest.webmanifest"><link rel="icon" href="./public/assets/icon-192.png">
<link rel="stylesheet" href="./styles/styles.css"><meta name="theme-color" content="#17B26A"/>
<style>
  .grid{display:grid;grid-template-columns:1fr .9fr;gap:14px}@media(max-width:980px){.grid{grid-template-columns:1fr}}
  .list{max-height:540px;overflow:auto}.row{padding:.55rem;border-bottom:1px solid var(--ring);display:grid;grid-template-columns:1.5fr .6fr .6fr 1fr .8fr;gap:10px;align-items:center}
  .row input{width:100%}.muted{color:var(--muted)} .mono{font-family:ui-monospace,Menlo,Consolas,monospace}
</style></head><body>
<div class="hero-card"><img src="./public/assets/banner.png" alt="Dr. Charan Child Clinic"></div>
<div class="topbar"><button class="btn" id="themeBtn">Theme</button><button class="btn" id="clearCacheBtn">Clear Cache</button><button class="btn" id="logoutBtn">Logout</button></div>

<div class="app"><div class="page-card">
  <h2 style="margin:0 0 6px">Pharmacy — Inventory</h2>
  <div class="grid">
    <!-- Add/Update -->
    <div class="page-card">
      <h3 style="margin-top:0">New / Update Item</h3>
      <div class="grid" style="grid-template-columns:1fr 1fr">
        <div><label class="small">Name</label><input id="name" class="in"></div>
        <div><label class="small">SKU</label><input id="sku" class="in mono"></div>
        <div><label class="small">Barcode</label><input id="barcode" class="in mono"></div>
        <div><label class="small">MRP</label><input id="mrp" type="number" step=".01" class="in mono"></div>
        <div><label class="small">Stock</label><input id="stock" type="number" class="in mono"></div>
      </div>
      <div style="height:8px"></div>
      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button class="btn" id="clearBtn">Clear</button>
        <button class="btn primary" id="saveBtn">Save</button>
      </div>
      <div class="small muted" id="msg" style="margin-top:6px"></div>
    </div>

    <!-- Master list -->
    <div class="page-card">
      <h3 style="margin-top:0">Items</h3>
      <input id="q" class="in" placeholder="Search name / sku / barcode">
      <div class="list" id="list"></div>
    </div>
  </div>
</div></div>

<footer class="small">© 2025 Onestop Ai services. All rights Reserved</footer>

<script src="https://cdn.jsdelivr.net/npm/dexie@4/dist/dexie.min.js"></script>
<script type="module">
  import db from './scripts/db.js';
  const html=document.documentElement,saved=localStorage.getItem('theme')||'dark';html.setAttribute('data-theme',saved);
  themeBtn.onclick=()=>{const n=html.getAttribute('data-theme')==='dark'?'light':'dark';html.setAttribute('data-theme',n);localStorage.setItem('theme',n)};
  logoutBtn.onclick=()=>{localStorage.removeItem('role');location.href='./login.html'};
  clearCacheBtn.onclick=async()=>{if(!confirm('Clear caches + DB?'))return;if('caches'in window){const ns=await caches.keys();for(const n of ns)await caches.delete(n)}localStorage.clear();location.reload()};

  const E=id=>document.getElementById(id), msg=E('msg'), list=E('list'), q=E('q');
  function getForm(){ return { name:E('name').value.trim(), sku:E('sku').value.trim()||null, barcode:E('barcode').value.trim()||null, mrp:Number(E('mrp').value||0), stock:Number(E('stock').value||0) }; }
  function setForm(p){ E('name').value=p?.name||''; E('sku').value=p?.sku||''; E('barcode').value=p?.barcode||''; E('mrp').value=p?.mrp||''; E('stock').value=p?.stock||''; }
  clearBtn.onclick=()=>{ setForm({}); msg.textContent=''; };

  saveBtn.onclick=async()=>{
    const f=getForm(); if(!f.name){msg.textContent='Name required';return;}
    let it = f.sku ? await db.pharmacyItems.where('sku').equals(f.sku).first() : null;
    if(!it) it = await db.pharmacyItems.where('name').equals(f.name).first();
    if(it){ await db.pharmacyItems.update(it.id,f); msg.textContent='Updated.'; }
    else{ await db.pharmacyItems.add(f); msg.textContent='Added.'; }
    render();
  };

  q.addEventListener('input',render);
  async function render(){
    const s=(q.value||'').toLowerCase(); let rows=await db.pharmacyItems.toArray();
    if(s){rows=rows.filter(r=>[r.name,r.sku,r.barcode].map(x=>(x||'').toLowerCase()).join('|').includes(s));}
    rows.sort((a,b)=>(a.name||'').localeCompare(b.name||'')); list.innerHTML='';
    rows.forEach(p=>{
      const div=document.createElement('div'); div.className='row';
      div.innerHTML=`
        <input class="in" value="${p.name||''}" data-k="name">
        <input class="in mono" value="${p.sku||''}" data-k="sku">
        <input class="in mono" value="${p.barcode||''}" data-k="barcode">
        <input class="in mono" type="number" step=".01" value="${p.mrp||0}" data-k="mrp">
        <div style="display:flex;gap:6px;align-items:center">
          <input class="in mono" type="number" value="${p.stock||0}" data-k="stock">
          <button class="btn" data-act="save">Save</button>
        </div>`;
      div.querySelector('[data-act="save"]').onclick=async()=>{
        const data={}; div.querySelectorAll('[data-k]').forEach(inp=>data[inp.dataset.k]=inp.type==='number'?Number(inp.value||0):inp.value.trim()||null);
        await db.pharmacyItems.update(p.id,data); render();
      };
      div.onclick=(e)=>{ if(e.target.tagName==='BUTTON')return; setForm(p); };
      list.appendChild(div);
    });
  }
  render();
</script></body></html>